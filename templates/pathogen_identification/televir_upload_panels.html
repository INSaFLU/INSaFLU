{% extends 'pathogen_identification/televir_references_base.html' %}

{% load bootstrap4 %}
{% load querystring from django_tables2 %}
{% load title from django_tables2 %}
{% load trans blocktrans from i18n %}
{% load django_bootstrap_breadcrumbs %}
{% load static %}

{% block content %}

<style>
    .alert {
        margin-top: 10px;
    }
    body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f6f6f6;
        font-family: Arial, sans-serif;
    }
    
    form {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.1);
    }
    
    button {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        margin: 10px 0;
        border: none;
        cursor: pointer;
        width: 100%;
        border-radius: 4px;
    }
    
    button[type="submit"]:disabled {
        background-color: #cccccc;
    }

    #id_description {
        width: 100%;
        height: 100px;
    }

    #id_name {
        width: 100%;
    }
    
    #summary {
        border: 1px solid;
        padding: 10px;
        margin-bottom: 10px;
        display: none;
    }

</style>

<form id="upload-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <div id="summary" style="border: 1px solid; padding: 10px; margin-bottom: 10px;"></div>
    <button type="button" id="check-button" url="{% url 'check_televir_panel_upload' %}">Check</button>
    <button type="submit">Upload</button>
</form>
{% endblock %}

{% block js %}
<script>
    $(document).ready(function() {
        $('button[type="submit"]').prop('disabled', true);
        let url = $('#check-button').attr('url');
        console.log(url);
        
        $('#check-button').click(function() {
            console.log('check');
            var formData = new FormData($('#upload-form')[0]);
            $.ajax({
                url: url,
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(data) {
                    console.log(data);
                    $('#summary').html(data);
                    if (data["is_ok"] == true) {
                        if (data["pass"] == true) {
                            $('button[type="submit"]').prop('disabled', false);
                        }
                        $('#summary').html(data["log"].join('<br>'));
                        $('#summary').html(data["log"].join('<br>')).show();                  
                    } else if (data["is_error"]) {
                        $('#id_messages_remove').append('<div class="alert alert-danger" role="alert">' + data["error_message"] + '</div>');
                    } else {
                        $('button[type="submit"]').prop('disabled', true);
                    }
                }
            });
        });
    });

    
</script>

{% endblock %}
