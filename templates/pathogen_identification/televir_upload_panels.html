{% extends '_layouts/base.html' %}

{% load bootstrap4 %}
{% load querystring from django_tables2 %}
{% load title from django_tables2 %}
{% load trans blocktrans from i18n %}
{% load django_bootstrap_breadcrumbs %}
{% load static %}
{% load custom_tags %}


{% block extra_messages %}
<!-- set the messages -->
<div class="container">
	<div id="id_messages_remove"></div>
</div>
{% endblock %}

{% block breadcrumbs %}
{{ block.super }}
{% breadcrumb "Project Index" "project-index" %}
{% breadcrumb "TELEVIR Projects" "PIprojects_main" %}
{% breadcrumb "Manage References" "" %}
{% endblock %}


{% block content %}


<style>

    .nav-style {
        border-radius: 5px;
        background-color: #f8f9fa;
        padding: 10px;
        margin-left: 10px;
        margin-bottom: 10px;
        margin-right: 10px;
    }

    .tab {
        border-radius: 5px;
        background-color: #f8f9fa;

    }

    ul li.active {
        background-color: #007bff; /* Light, desaturated blue */
        color: white; /* Font color */
       
        padding: 2px; /* Padding */
    }

    ul li.active a {
        background-color: #007bff; /* Light, desaturated blue */
        color: white; /* Font color */
       
        padding: 2px; /* Padding */
    }

    .alert {
        margin-top: 10px;
    }

    body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f6f6f6;
        font-family: Arial, sans-serif;
    }
    
    form {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.1);
    }
    
    button {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        margin: 10px 0;
        border: none;
        cursor: pointer;
        width: 100%;
        border-radius: 4px;
    }
    
    button[type="submit"]:disabled {
        background-color: #cccccc;
    }

    #id_description {
        width: 100%;
        height: 50px;
    }

    #id_name {
        width: 100%;
    }
    
    #summary {
        border: 1px solid;
        padding: 10px;
        margin-bottom: 10px;
    }
    .helptext {
        color: gray;
        display: block;
        margin-top: 5px;
        margin-bottom: 0px;
        margin-left: 20px;

    }
    .tab {
        margin-left: 20px;
        color: gray;
        display: block;
        margin-top: 0px;
    }

    textarea {
        border: 1px solid #ced4da;
        border-radius: .25rem;
    }

    #summary {
        border: 1px solid #ced4da;
        border-radius: .25rem;
        padding: 10px;
        margin-bottom: 10px;
        background-color: #F0F8FF; /* Adjust as needed */
        color: gray; /* Adjust as needed */
        font-size: 12px; /* Adjust as needed */
        height: 100px;
        font-family: Arial, sans-serif;
        font-style: italic;
        font-size: 16px;
    }

    #summary active {
        font-style: normal;
        color: black;
    }
     
    .button-container {
        width: 100%;
        display: flex;
        justify-content: flex-end;
    }
    
    .button-container button {
        margin: 5px;
    }

    #check-button {
        margin: 5px;
    }

</style>

<form id="upload-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <div id="summary" style="border: 1px solid; padding: 10px; margin-bottom: 10px;">
        <p>Upload Summary.</p>
    </div>
    <button type="button" id="check-button" url="{% url 'check_televir_panel_upload' %}">Check</button>
    
    <div class="button-container">
        <button onclick="location.href='{% url 'televir_reference_files' %}'" class="cancel-button">Cancel</button>
        <button type="submit" class="upload-button">Upload</button>
    </div>
</form>

{% endblock %}

{% block js %}
<script>
    $(document).ready(function() {
        $('button[type="submit"]').prop('disabled', true);

        let url = $('#check-button').attr('url');
        console.log(url);
        
        $('#check-button').click(function() {
            var formData = new FormData($('#upload-form')[0]);
            $.ajax({
                url: url,
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(data) {
                    $('#summary').html(data);
                    if (data["is_ok"] == true) {
                        if (data["pass"] == true) {
                            $('button[type="submit"]').prop('disabled', false);
                        }
                        $('#summary').html(data["log"].join('<br>'));
                        $('#summary').addClass('active');
                        $('#summary').html(data["log"].join('<br>')).show();                  
                    } else if (data["is_error"]) {
                        $('#id_messages_remove').append('<div class="alert alert-danger" role="alert">' + data["error_message"] + '</div>');
                    } else {
                        $('button[type="submit"]').prop('disabled', true);
                    }
                }
            });
        });
    });

    
</script>

{% endblock %}
